{"id":117,"date":"2020-06-24T03:51:38","date_gmt":"2020-06-24T03:51:38","guid":{"rendered":"https:\/\/qgustavor.duckdns.org\/blog\/modulos\/"},"modified":"2024-04-27T18:34:12","modified_gmt":"2024-04-27T21:34:12","slug":"modulos","status":"publish","type":"post","link":"https:\/\/qgustavor.duckdns.org\/blog\/modulos\/","title":{"rendered":"Experimentando com m\u00f3dulos"},"content":{"rendered":"<p>No momento estou trabalhando para remover qualquer parte dos scripts que organizam os meus animes que dependam do MyAnimeList. Resolvi, aproveitando o clima que est\u00e1 j\u00e1 que a vers\u00e3o 1 do Deno foi recentemente publicada, fazer alguns testes com m\u00f3dulos ES.<\/p>\n<p>Como no momento o Deno ainda est\u00e1 muito novo estou evitando ele para esse projeto e usando o Node, mas como boa parte desse clima de sair experimentando com esses m\u00f3dulos sem depender de Webpack, Parcel ou Rollup come\u00e7ou no Deno eu acabei levando uns sustos quando fui testar no Node.<\/p>\n<p>Para come\u00e7ar eu n\u00e3o sabia que o import.meta.main era algo exclusivo do Deno. Achei que fosse algo &quot;padr\u00e3o&quot;, j\u00e1 que o Deno se valoriza tanto por isso. Acabei fazendo isso um desafio: escrever uma fun\u00e7\u00e3o que retorna se um m\u00f3dulo \u00e9 o principal ou n\u00e3o:<\/p>\n<pre><code class=\"language-javascript\">export default function isMain (meta) {\n  if (meta.main) return true\n  if (typeof Deno !== 'undefined') return false\n  if (typeof document !== 'undefined') {\n    return Array.from(document.scripts).some(e =&gt; e.src === meta.url)\n  }\n\n  if (typeof process !== 'undefined') {\n    const calledScript = process.argv[1]\n    const normalize = e =&gt; e.split(\/[\/\\]\/).pop().toLowerCase().replace(\/..*$\/, '')\n    return normalize(calledScript) === normalize(meta.url)\n  }\n\n  if (typeof WorkerGlobalScope !== 'undefined') {\n    return self.location.href === meta.url\n  }\n\n  throw Error('could not find if module is main')\n}<\/code><\/pre>\n<p>No Deno e em navegadores funciona bem mas no Node \u00e9 uma gambiarra. H\u00e1 um m\u00f3dulo no NPM que faz isso e, claro, deve fazer melhor. Espero que no futuro isso seja padronizado.<\/p>\n<p>Um outro experimento que resolvi fazer foi pegar o <a href=\"https:\/\/qgustavor.github.io\/mkv-extract\/\">MKV Extract<\/a> e migrar ele de JavaScript para TypeScript, de CommonJS para ESM, e de Browserify para Parcel. Al\u00e9m disso agora ele usa GitHub Actions o que significa que n\u00e3o preciso ficar compilando no meu computador o site se algu\u00e9m enviar um pull request corrigindo alguma coisa, \u00e9 bem mais pr\u00e1tico.<\/p>\n<p>Quero terminar de arrumar esses scripts logo: as partes que dependem do MAL j\u00e1 est\u00e3o dando problemas (mesmo com a API n\u00e3o oficial) e, como eu disse antes, em setembro a API que eu estava usando para gerar as estat\u00edsticas vai parar de funcionar. Na pr\u00e1tica estou s\u00f3 organizando as coisas: ao inv\u00e9s de ter um monte de informa\u00e7\u00e3o espalhada em uma planilha e um monte de arquivos JSON e TXT o meu plano \u00e9 juntar tudo em um \u00fanico ponto.<\/p>\n<p>Assim que eu terminar vai ficar mais f\u00e1cil gerar as estat\u00edsticas e ainda quero fazer um aplicativo para celular para poder votar nos animes sem precisar de internet. Claro, estamos na \u00e9poca onde todo mundo tem internet a qualquer momento, mas pelo menos nisso eu n\u00e3o sou todo mundo: minha internet \u00e9 t\u00e3o ruim que a conex\u00e3o cai at\u00e9 dentro de casa!<\/p>\n<p>Eu quero fazer um gr\u00e1fico da nota de cada anime por epis\u00f3dio. \u00c9 uma pena que s\u00f3 vou implementar isso depois de mais de cinco anos que comecei a coletar esses dados, mas antes tarde do que nunca. Enfim, isso \u00e9 tudo por hoje, at\u00e9 semana que vem.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>No momento estou trabalhando para remover qualquer parte dos scripts que organizam os meus animes que dependam do MyAnimeList. Resolvi, aproveitando o clima que est\u00e1 j\u00e1 que a vers\u00e3o 1 do Deno foi recentemente publicada, fazer alguns testes com m\u00f3dulos ES. Como no momento o Deno ainda est\u00e1 muito novo estou evitando ele para esse [&hellip;]<\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"closed","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[9],"tags":[],"yoast_head":"<!-- This site is optimized with the Yoast SEO plugin v22.5 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\r\n<title>Experimentando com m\u00f3dulos - o canto do qgustavor<\/title>\r\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\r\n<link rel=\"canonical\" href=\"https:\/\/qgustavor.duckdns.org\/blog\/modulos\/\" \/>\r\n<meta property=\"og:locale\" content=\"pt_BR\" \/>\r\n<meta property=\"og:type\" content=\"article\" \/>\r\n<meta property=\"og:title\" content=\"Experimentando com m\u00f3dulos - o canto do qgustavor\" \/>\r\n<meta property=\"og:description\" content=\"No momento estou trabalhando para remover qualquer parte dos scripts que organizam os meus animes que dependam do MyAnimeList. Resolvi, aproveitando o clima que est\u00e1 j\u00e1 que a vers\u00e3o 1 do Deno foi recentemente publicada, fazer alguns testes com m\u00f3dulos ES. Como no momento o Deno ainda est\u00e1 muito novo estou evitando ele para esse [&hellip;]\" \/>\r\n<meta property=\"og:url\" content=\"https:\/\/qgustavor.duckdns.org\/blog\/modulos\/\" \/>\r\n<meta property=\"og:site_name\" content=\"o canto do qgustavor\" \/>\r\n<meta property=\"article:published_time\" content=\"2020-06-24T03:51:38+00:00\" \/>\r\n<meta property=\"article:modified_time\" content=\"2024-04-27T21:34:12+00:00\" \/>\r\n<meta name=\"author\" content=\"qgustavor\" \/>\r\n<meta name=\"twitter:card\" content=\"summary_large_image\" \/>\r\n<meta name=\"twitter:creator\" content=\"@qgustavor\" \/>\r\n<meta name=\"twitter:site\" content=\"@qgustavor\" \/>\r\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"Article\",\"@id\":\"https:\/\/qgustavor.duckdns.org\/blog\/modulos\/#article\",\"isPartOf\":{\"@id\":\"https:\/\/qgustavor.duckdns.org\/blog\/modulos\/\"},\"author\":{\"name\":\"qgustavor\",\"@id\":\"https:\/\/qgustavor.duckdns.org\/blog\/#\/schema\/person\/5005d30bb095ab19661abe12ea303b52\"},\"headline\":\"Experimentando com m\u00f3dulos\",\"datePublished\":\"2020-06-24T03:51:38+00:00\",\"dateModified\":\"2024-04-27T21:34:12+00:00\",\"mainEntityOfPage\":{\"@id\":\"https:\/\/qgustavor.duckdns.org\/blog\/modulos\/\"},\"wordCount\":449,\"publisher\":{\"@id\":\"https:\/\/qgustavor.duckdns.org\/blog\/#\/schema\/person\/5005d30bb095ab19661abe12ea303b52\"},\"articleSection\":[\"Programa\u00e7\u00e3o\"],\"inLanguage\":\"pt-BR\"},{\"@type\":\"WebPage\",\"@id\":\"https:\/\/qgustavor.duckdns.org\/blog\/modulos\/\",\"url\":\"https:\/\/qgustavor.duckdns.org\/blog\/modulos\/\",\"name\":\"Experimentando com m\u00f3dulos - o canto do qgustavor\",\"isPartOf\":{\"@id\":\"https:\/\/qgustavor.duckdns.org\/blog\/#website\"},\"datePublished\":\"2020-06-24T03:51:38+00:00\",\"dateModified\":\"2024-04-27T21:34:12+00:00\",\"breadcrumb\":{\"@id\":\"https:\/\/qgustavor.duckdns.org\/blog\/modulos\/#breadcrumb\"},\"inLanguage\":\"pt-BR\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https:\/\/qgustavor.duckdns.org\/blog\/modulos\/\"]}]},{\"@type\":\"BreadcrumbList\",\"@id\":\"https:\/\/qgustavor.duckdns.org\/blog\/modulos\/#breadcrumb\",\"itemListElement\":[{\"@type\":\"ListItem\",\"position\":1,\"name\":\"In\u00edcio\",\"item\":\"https:\/\/qgustavor.duckdns.org\/blog\/\"},{\"@type\":\"ListItem\",\"position\":2,\"name\":\"Experimentando com m\u00f3dulos\"}]},{\"@type\":\"WebSite\",\"@id\":\"https:\/\/qgustavor.duckdns.org\/blog\/#website\",\"url\":\"https:\/\/qgustavor.duckdns.org\/blog\/\",\"name\":\"o canto do qgustavor\",\"description\":\"\",\"publisher\":{\"@id\":\"https:\/\/qgustavor.duckdns.org\/blog\/#\/schema\/person\/5005d30bb095ab19661abe12ea303b52\"},\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":{\"@type\":\"EntryPoint\",\"urlTemplate\":\"https:\/\/qgustavor.duckdns.org\/blog\/?s={search_term_string}\"},\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"pt-BR\"},{\"@type\":[\"Person\",\"Organization\"],\"@id\":\"https:\/\/qgustavor.duckdns.org\/blog\/#\/schema\/person\/5005d30bb095ab19661abe12ea303b52\",\"name\":\"qgustavor\",\"image\":{\"@type\":\"ImageObject\",\"inLanguage\":\"pt-BR\",\"@id\":\"https:\/\/qgustavor.duckdns.org\/blog\/#\/schema\/person\/image\/\",\"url\":\"https:\/\/secure.gravatar.com\/avatar\/4039a864f60bdb71f6b8ad64f0b94f87?size=256\",\"contentUrl\":\"https:\/\/secure.gravatar.com\/avatar\/4039a864f60bdb71f6b8ad64f0b94f87?size=256\",\"width\":256,\"height\":256,\"caption\":\"qgustavor\"},\"logo\":{\"@id\":\"https:\/\/qgustavor.duckdns.org\/blog\/#\/schema\/person\/image\/\"},\"sameAs\":[\"https:\/\/qgustavor.tk\",\"https:\/\/x.com\/qgustavor\"]}]}<\/script>\r\n<!-- \/ Yoast SEO plugin. -->","yoast_head_json":{"title":"Experimentando com m\u00f3dulos - o canto do qgustavor","robots":{"index":"index","follow":"follow","max-snippet":"max-snippet:-1","max-image-preview":"max-image-preview:large","max-video-preview":"max-video-preview:-1"},"canonical":"https:\/\/qgustavor.duckdns.org\/blog\/modulos\/","og_locale":"pt_BR","og_type":"article","og_title":"Experimentando com m\u00f3dulos - o canto do qgustavor","og_description":"No momento estou trabalhando para remover qualquer parte dos scripts que organizam os meus animes que dependam do MyAnimeList. Resolvi, aproveitando o clima que est\u00e1 j\u00e1 que a vers\u00e3o 1 do Deno foi recentemente publicada, fazer alguns testes com m\u00f3dulos ES. Como no momento o Deno ainda est\u00e1 muito novo estou evitando ele para esse [&hellip;]","og_url":"https:\/\/qgustavor.duckdns.org\/blog\/modulos\/","og_site_name":"o canto do qgustavor","article_published_time":"2020-06-24T03:51:38+00:00","article_modified_time":"2024-04-27T21:34:12+00:00","author":"qgustavor","twitter_card":"summary_large_image","twitter_creator":"@qgustavor","twitter_site":"@qgustavor","schema":{"@context":"https:\/\/schema.org","@graph":[{"@type":"Article","@id":"https:\/\/qgustavor.duckdns.org\/blog\/modulos\/#article","isPartOf":{"@id":"https:\/\/qgustavor.duckdns.org\/blog\/modulos\/"},"author":{"name":"qgustavor","@id":"https:\/\/qgustavor.duckdns.org\/blog\/#\/schema\/person\/5005d30bb095ab19661abe12ea303b52"},"headline":"Experimentando com m\u00f3dulos","datePublished":"2020-06-24T03:51:38+00:00","dateModified":"2024-04-27T21:34:12+00:00","mainEntityOfPage":{"@id":"https:\/\/qgustavor.duckdns.org\/blog\/modulos\/"},"wordCount":449,"publisher":{"@id":"https:\/\/qgustavor.duckdns.org\/blog\/#\/schema\/person\/5005d30bb095ab19661abe12ea303b52"},"articleSection":["Programa\u00e7\u00e3o"],"inLanguage":"pt-BR"},{"@type":"WebPage","@id":"https:\/\/qgustavor.duckdns.org\/blog\/modulos\/","url":"https:\/\/qgustavor.duckdns.org\/blog\/modulos\/","name":"Experimentando com m\u00f3dulos - o canto do qgustavor","isPartOf":{"@id":"https:\/\/qgustavor.duckdns.org\/blog\/#website"},"datePublished":"2020-06-24T03:51:38+00:00","dateModified":"2024-04-27T21:34:12+00:00","breadcrumb":{"@id":"https:\/\/qgustavor.duckdns.org\/blog\/modulos\/#breadcrumb"},"inLanguage":"pt-BR","potentialAction":[{"@type":"ReadAction","target":["https:\/\/qgustavor.duckdns.org\/blog\/modulos\/"]}]},{"@type":"BreadcrumbList","@id":"https:\/\/qgustavor.duckdns.org\/blog\/modulos\/#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"In\u00edcio","item":"https:\/\/qgustavor.duckdns.org\/blog\/"},{"@type":"ListItem","position":2,"name":"Experimentando com m\u00f3dulos"}]},{"@type":"WebSite","@id":"https:\/\/qgustavor.duckdns.org\/blog\/#website","url":"https:\/\/qgustavor.duckdns.org\/blog\/","name":"o canto do qgustavor","description":"","publisher":{"@id":"https:\/\/qgustavor.duckdns.org\/blog\/#\/schema\/person\/5005d30bb095ab19661abe12ea303b52"},"potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https:\/\/qgustavor.duckdns.org\/blog\/?s={search_term_string}"},"query-input":"required name=search_term_string"}],"inLanguage":"pt-BR"},{"@type":["Person","Organization"],"@id":"https:\/\/qgustavor.duckdns.org\/blog\/#\/schema\/person\/5005d30bb095ab19661abe12ea303b52","name":"qgustavor","image":{"@type":"ImageObject","inLanguage":"pt-BR","@id":"https:\/\/qgustavor.duckdns.org\/blog\/#\/schema\/person\/image\/","url":"https:\/\/secure.gravatar.com\/avatar\/4039a864f60bdb71f6b8ad64f0b94f87?size=256","contentUrl":"https:\/\/secure.gravatar.com\/avatar\/4039a864f60bdb71f6b8ad64f0b94f87?size=256","width":256,"height":256,"caption":"qgustavor"},"logo":{"@id":"https:\/\/qgustavor.duckdns.org\/blog\/#\/schema\/person\/image\/"},"sameAs":["https:\/\/qgustavor.tk","https:\/\/x.com\/qgustavor"]}]}},"_links":{"self":[{"href":"https:\/\/qgustavor.duckdns.org\/blog\/wp-json\/wp\/v2\/posts\/117"}],"collection":[{"href":"https:\/\/qgustavor.duckdns.org\/blog\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/qgustavor.duckdns.org\/blog\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/qgustavor.duckdns.org\/blog\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/qgustavor.duckdns.org\/blog\/wp-json\/wp\/v2\/comments?post=117"}],"version-history":[{"count":1,"href":"https:\/\/qgustavor.duckdns.org\/blog\/wp-json\/wp\/v2\/posts\/117\/revisions"}],"predecessor-version":[{"id":1212,"href":"https:\/\/qgustavor.duckdns.org\/blog\/wp-json\/wp\/v2\/posts\/117\/revisions\/1212"}],"wp:attachment":[{"href":"https:\/\/qgustavor.duckdns.org\/blog\/wp-json\/wp\/v2\/media?parent=117"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/qgustavor.duckdns.org\/blog\/wp-json\/wp\/v2\/categories?post=117"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/qgustavor.duckdns.org\/blog\/wp-json\/wp\/v2\/tags?post=117"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}